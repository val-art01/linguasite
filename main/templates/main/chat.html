{% load i18n %}
{% load static %}
<!DOCTYPE html>
<html >
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.2/assets/css/docs.css" rel="stylesheet">
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="{% static 'css/chat.css' %}" rel="stylesheet">
    <title>{% trans "Chat avec GPT-3" %}</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-primary p-3">
      <div class="container-fluid">
        <a class="navbar-brand text-white" href="#">Test Technique</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link text-white" aria-current="page" href="{% url 'main-index' %}">{% trans 'Acceuil' %}</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-white" href="{% url 'main-create' %}">{% trans 'Ajouter un article' %}</a>
            </li><li class="nav-item">
              <a class="nav-link text-white" href="{% url 'main-chat' %}">{% trans 'Chat avec GPT-3' %}</a>
            </li>
          </ul>
        </div>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link text-white bg-dark" href="{% url 'set-language' 'fr' %}">{% trans "Français" %}</a></li>
                <li class="nav-item"><a class="nav-link text-white bg-dark" href="{% url 'set-language' 'en' %}">{% trans "Anglais" %}</a></li>
            </ul>
        </div>
      </div>
    </nav>

      <div class="flex-md-equal my-md-3 ps-md-3">
        <div class="text-bg-dark me-md-3 pt-3 px-5 pt-md-5 px-md-5 text-center overflow-hidden">
          <div class="my-1 py-3">
             <h1>{% trans "Chat avec GPT-4" %}</h1>
          </div>
          <div class="bg-light shadow-sm mx-auto" style="border-radius: 21px 21px 0 0;">
              <form onsubmit="submitQuestion(event)">
                  {% csrf_token %}
                  <div class="form-row">
                     <br>
                     <div class="form-floating">
                        <textarea style="  height: 100px" class="form-control fs-3" cols="10" id="question" name="question" placeholder="{% trans "Posez votre question" %}" required ></textarea>
                        <br />
                        <div class="underline"></div>
                        <br />
                    </div>
                  </div>
                  <button type="submit" class="btn btn-outline-dark me-2">{% trans "Envoyer" %}</button>
              </form>
          </div>
        </div>
           <div class="text-bg-succes me-md-3 pt-3 px-5 pt-md-5 px-md-5 text-center overflow-hidden">
               <br>
               <h2>{% trans "Réponse" %}</h2>
               <div class="bg-light shadow-sm mx-auto" style="border-radius: 21px 21px 0 0;">
                   <p class="text-start p-3 fs-3" id="answer"></p>
               </div>
           </div>
      </div>






    <script>
        /**
         * Soumet une question à un serveur et affiche la réponse.
         *
         * Cette fonction est déclenchée par un événement de soumission de formulaire. Elle empêche le comportement
         * par défaut du formulaire, récupère la question saisie par l'utilisateur, envoie cette question au serveur
         * via une requête POST, puis affiche la réponse reçue du serveur dans l'élément avec l'ID 'answer'.
         *
         * @async
         * @function submitQuestion
         * @param {Event} event - L'événement de soumission du formulaire.
         * @returns {Promise<void>} Une promesse qui est résolue lorsque la fonction est terminée.
         *
         */
        async function submitQuestion(event){
            event.preventDefault();
            const question = document.getElementById('question').value;
            const response = await fetch('', {
                method:'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: new URLSearchParams({
                    'question': question
                })
            });
            const  data = await response.json();
            if (data.error) {
                document.getElementById('answer').innerText = data.error;
            } else {
                document.getElementById('answer').innerText = data.answer;
            }
        }
    </script>
</body>
</html>